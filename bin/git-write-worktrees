#! /bin/bash

# -----------------------------------------------------------------------------

set -euo pipefail
readonly _DIRNAME=$( cd "$( dirname "${BASH_SOURCE[ 0 ]}" )" && realpath . )
readonly _BASENAME=$( basename ${BASH_SOURCE[ 0 ]} )
readonly _ROOT=$( dirname ${_DIRNAME} )


# defaults --------------------------------------------------------------------

source ${_ROOT}/etc/defaults 


# checkout and update ---------------------------------------------------------

[[ ! -d ${git_dir} ]] && ${git_binary} clone ${git_url} ${git_dir}
${git_binary} --git-dir=${git_dir}/.git pull --update


# write worktrees -------------------------------------------------------------

rm -rf ${_ROOT}/src/${github_path}
${git_binary} --git-dir ${git_dir}/.git worktree prune
${git_binary} --git-dir ${git_dir}/.git worktree add --force --checkout --guess-remote ${git_worktree_root}/master  master
${git_binary} --git-dir ${git_dir}/.git worktree add --force --checkout --guess-remote ${git_worktree_root}/9.x     remotes/origin/release/9.x
${git_binary} --git-dir ${git_dir}/.git worktree list

